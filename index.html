<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <script src="app.js"></script>
    <script src="jquery-2.1.1.min.js"></script>
    <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/pure-min.css">

    <style>
      .button-success {
          background: rgb(28, 184, 65); /* this is a green */
      }

      #sub-entry-form {
          display: none;
      }

      .pure-u-* {
          margin: 10px;
      }
    </style>
  </head>
  <body>
    <div class="pure-g">
      <div class="pure-u-1-2">
        <!-- 1. The <iframe> (and video player) will replace this <div> tag. -->
        <div id="player"></div>
      </div>
      <div class="pure-u-1-3">
        <div class="pure-u-1">
          <div id="time"></div>
          <textarea id="sub-result" readonly></textarea>
        </div>

        <div class="pure-u-1"">
          <a id="start-button" class="pure-button" href="#">Start</a>
          <a id="end-button" class="pure-button" href="#">End</a>
        </div>

        <div id="sub-entry-form" class="pure-u-1">
          <textarea id="sub-text"></textarea>
          <div>
            <button id="save-button" class="pure-button" type="submit">
              Save subtitle
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      $( document ).ready(function(){
          console.log("ready");
          $( "#sub-result" ).val("");
          $( "#sub-text" ).val("");
      })

      // 2. This code loads the IFrame Player API code asynchronously.
      var tag = document.createElement('script');

      tag.src = "https://www.youtube.com/iframe_api";
      var firstScriptTag = document.getElementsByTagName('script')[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

      // 3. This function creates an <iframe> (and YouTube player)
      //    after the API code downloads.
      var player;
      function onYouTubeIframeAPIReady() {
          player = new YT.Player('player', {
              height: '390',
              width: '640',
              videoId: 'M7lc1UVf-VE',
              events: {
                  'onReady': onPlayerReady,
                  'onStateChange': onPlayerStateChange
              }
          });
      }

      function setSrtDuration() {
          var dur = formatSrtTime(player.getCurrentTime());
          //console.log("setSrtDuration: " + dur);
          $('#time').html(dur);
      }

      // 4. The API will call this function when the video player is ready.
      function onPlayerReady(event) {
          event.target.playVideo();
          // window.setInterval(setSrtDuration, 100);

      }

      // 5. The API calls this function when the player's state changes.
      //    The function indicates that when playing a video (state=1),
      //    the player should play for six seconds and then stop.
      var done = false;
      function onPlayerStateChange(event) {
          if (event.data == YT.PlayerState.PLAYING && !done) {
              setTimeout(stopVideo, 600000);
              done = true;
          }
      }
      function stopVideo() {
          player.stopVideo();
      }


      // ===============================

      var subtitles = []
      var currentSubStartTime = "";
      var currentSubEndTime = "";
      var currentSubText = "";

      $( "#start-button" ).click(function() {
          // set start subtime
          currentSubStartTime = player.getCurrentTime();

          // set color button sucess
          $( "#start-button" ).addClass("button-sucess");

          // alert( "Handler for start-button .click() called." );
      });

      $( "#end-button" ).click(function() {
          // set end subs time
          currentSubEndTime = player.getCurrentTime();

          // pause video
          player.pauseVideo();

          // show sub-entry-form
          $( "#sub-entry-form" ).show();

          // alert( "Handler for end-button .click() called." );
      });

      $( "#sub-text" ).keyup(function() {
          currentSubText = $("#sub-text").val();
          // alert( "Handler for .keyup() called." );
      });

      $( "#save-button" ).click(function() {
          // append subtitle object to subtitles array
          sub = buildSubtitle(
              getNextId(subtitles),
              currentSubStartTime,
              currentSubEndTime,
              currentSubText
          );
          subtitles.push(sub);

          // append subtitle to subs-result
          subtitleString = formatSrtSubtitleString(sub);
          $( "#sub-result" ).val($( "#sub-result" ).val() + subtitleString);

          console.log(subtitleString);

          // clear sub-text
          $( "#sub-text" ).val("");

          // hide sub-entry-form
          $( "#sub-entry-form" ).hide();

          // alert( "Handler for save-button .click() called." );
      });
    </script>
  </body>
</html>
